<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é¢œè‰²è®°å¿†æŒ‘æˆ˜</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .game-container {
            width: 100%;
            max-width: 400px;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .score-board {
            display: flex;
            justify-content: space-around;
            background: rgba(255,255,255,0.2);
            border-radius: 15px;
            padding: 12px;
            backdrop-filter: blur(10px);
        }

        .score-item {
            text-align: center;
        }

        .score-label {
            font-size: 12px;
            opacity: 0.8;
        }

        .score-value {
            font-size: 24px;
            font-weight: bold;
        }

        .game-board {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .color-btn {
            aspect-ratio: 1;
            border-radius: 20px;
            border: none;
            cursor: pointer;
            transition: all 0.15s ease;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }

        .color-btn:active {
            transform: scale(0.95);
        }

        .color-btn.active {
            animation: flash 0.4s ease;
        }

        @keyframes flash {
            0%, 100% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.1); filter: brightness(1.5); }
        }

        .color-btn.wrong {
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-10px); }
            40%, 80% { transform: translateX(10px); }
        }

        .btn-0 { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .btn-1 { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .btn-2 { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .btn-3 { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn-start {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .status {
            text-align: center;
            color: white;
            font-size: 16px;
            min-height: 24px;
            margin-top: 15px;
        }

        .game-over {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
            backdrop-filter: blur(5px);
        }

        .game-over-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            animation: popIn 0.3s ease;
        }

        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .game-over h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 28px;
        }

        .final-score {
            font-size: 48px;
            color: #667eea;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .best-score {
            color: #888;
            margin-bottom: 25px;
        }

        .btn-restart {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .instructions {
            color: rgba(255,255,255,0.8);
            text-align: center;
            font-size: 14px;
            margin-top: 15px;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>ğŸ¨ é¢œè‰²è®°å¿†</h1>
            <div class="score-board">
                <div class="score-item">
                    <div class="score-label">å…³å¡</div>
                    <div class="score-value" id="level">1</div>
                </div>
                <div class="score-item">
                    <div class="score-label">åˆ†æ•°</div>
                    <div class="score-value" id="score">0</div>
                </div>
                <div class="score-item">
                    <div class="score-label">æœ€ä½³</div>
                    <div class="score-value" id="best">0</div>
                </div>
            </div>
        </div>

        <div class="game-board">
            <button class="color-btn btn-0" data-index="0"></button>
            <button class="color-btn btn-1" data-index="1"></button>
            <button class="color-btn btn-2" data-index="2"></button>
            <button class="color-btn btn-3" data-index="3"></button>
        </div>

        <div class="controls">
            <button class="btn btn-start" id="startBtn">å¼€å§‹æ¸¸æˆ</button>
        </div>

        <div class="status" id="status">ç‚¹å‡»å¼€å§‹ï¼Œè®°ä½é—ªçƒé¡ºåºï¼</div>

        <div class="instructions">
            ğŸ‘† è§‚å¯Ÿé¢œè‰²é—ªçƒé¡ºåº<br>
            ç„¶åæŒ‰ç›¸åŒé¡ºåºç‚¹å‡»
        </div>
    </div>

    <div class="game-over" id="gameOver">
        <div class="game-over-content">
            <h2>æ¸¸æˆç»“æŸ!</h2>
            <div class="final-score" id="finalScore">0</div>
            <div class="best-score" id="bestScoreDisplay">æœ€ä½³: 0</div>
            <button class="btn btn-restart" id="restartBtn">å†æ¥ä¸€æ¬¡</button>
        </div>
    </div>

    <script>
        class MemoryGame {
            constructor() {
                this.sequence = [];
                this.playerSequence = [];
                this.level = 1;
                this.score = 0;
                this.bestScore = localStorage.getItem('bestScore') || 0;
                this.isPlaying = false;
                this.isComputerTurn = false;

                this.buttons = document.querySelectorAll('.color-btn');
                this.startBtn = document.getElementById('startBtn');
                this.restartBtn = document.getElementById('restartBtn');
                this.levelDisplay = document.getElementById('level');
                this.scoreDisplay = document.getElementById('score');
                this.bestDisplay = document.getElementById('best');
                this.statusDisplay = document.getElementById('status');
                this.gameOverModal = document.getElementById('gameOver');
                this.finalScoreDisplay = document.getElementById('finalScore');
                this.bestScoreDisplay = document.getElementById('bestScoreDisplay');

                this.init();
            }

            init() {
                this.bestDisplay.textContent = this.bestScore;
                this.startBtn.addEventListener('click', () => this.startGame());
                this.restartBtn.addEventListener('click', () => this.restartGame());
                this.buttons.forEach(btn => {
                    btn.addEventListener('click', (e) => this.handlePlayerClick(e));
                });
            }

            startGame() {
                this.sequence = [];
                this.playerSequence = [];
                this.level = 1;
                this.score = 0;
                this.isPlaying = true;
                this.updateDisplay();
                this.startBtn.style.display = 'none';
                this.addToSequence();
            }

            restartGame() {
                this.gameOverModal.style.display = 'none';
                this.startGame();
            }

            addToSequence() {
                this.playerSequence = [];
                this.sequence.push(Math.floor(Math.random() * 4));
                this.playSequence();
            }

            async playSequence() {
                this.isComputerTurn = true;
                this.statusDisplay.textContent = 'æ³¨æ„è§‚å¯Ÿ...';
                this.buttons.forEach(btn => btn.style.pointerEvents = 'none');

                await this.delay(600);

                for (let i = 0; i < this.sequence.length; i++) {
                    await this.flashButton(this.sequence[i]);
                    await this.delay(300 + Math.max(0, 400 - this.level * 20));
                }

                this.isComputerTurn = false;
                this.statusDisplay.textContent = 'è½®åˆ°ä½ äº†ï¼';
                this.buttons.forEach(btn => btn.style.pointerEvents = 'auto');
            }

            async flashButton(index) {
                const button = this.buttons[index];
                button.classList.add('active');
                
                // æ’­æ”¾éŸ³æ•ˆï¼ˆä½¿ç”¨ Web Audio APIï¼‰
                this.playTone(200 + index * 100, 150);
                
                await this.delay(300);
                button.classList.remove('active');
            }

            playTone(frequency, duration) {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = frequency;
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration / 1000);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + duration / 1000);
                } catch (e) {
                    // éŸ³é¢‘æ’­æ”¾å¤±è´¥é™é»˜å¤„ç†
                }
            }

            handlePlayerClick(e) {
                if (!this.isPlaying || this.isComputerTurn) return;

                const index = parseInt(e.target.dataset.index);
                this.playerSequence.push(index);
                
                // æ’­æ”¾ç‚¹å‡»éŸ³æ•ˆ
                this.playTone(200 + index * 100, 100);
                
                // æ·»åŠ ç‚¹å‡»åŠ¨ç”»
                e.target.classList.add('active');
                setTimeout(() => e.target.classList.remove('active'), 150);

                // æ£€æŸ¥æ˜¯å¦æ­£ç¡®
                const currentStep = this.playerSequence.length - 1;
                if (this.playerSequence[currentStep] !== this.sequence[currentStep]) {
                    this.gameOver();
                    return;
                }

                // æœ¬å›åˆå®Œæˆ
                if (this.playerSequence.length === this.sequence.length) {
                    this.score += this.level * 10;
                    this.level++;
                    this.updateDisplay();
                    this.statusDisplay.textContent = 'æ­£ç¡®ï¼ä¸‹ä¸€å…³...';
                    
                    if (this.score > this.bestScore) {
                        this.bestScore = this.score;
                        localStorage.setItem('bestScore', this.bestScore);
                        this.bestDisplay.textContent = this.bestScore;
                    }

                    setTimeout(() => this.addToSequence(), 1000);
                }
            }

            gameOver() {
                this.isPlaying = false;
                
                // é”™è¯¯éŸ³æ•ˆ
                this.playTone(150, 400);
                
                // é”™è¯¯åŠ¨ç”»
                this.buttons.forEach(btn => {
                    btn.classList.add('wrong');
                    setTimeout(() => btn.classList.remove('wrong'), 500);
                });

                this.finalScoreDisplay.textContent = this.score;
                this.bestScoreDisplay.textContent = `æœ€ä½³: ${this.bestScore}`;
                
                setTimeout(() => {
                    this.gameOverModal.style.display = 'flex';
                }, 600);
            }

            updateDisplay() {
                this.levelDisplay.textContent = this.level;
                this.scoreDisplay.textContent = this.score;
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // å¯åŠ¨æ¸¸æˆ
        new MemoryGame();
    </script>
</body>
</html>
